<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magasin autonome PIVOTIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f4f5; color: #18181b; }
        .nav-button { transition: all 0.3s ease; color: #71717a; }
        .nav-button.active { color: #f97316; border-bottom: 2px solid #f97316; }
        .nav-button:not(.active):hover { color: #18181b; }
        .section { display: none; animation: fadeInUp 0.6s ease-out; }
        .section.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .card { background-color: #ffffff; border: 1px solid #e4e4e7; border-radius: 0.75rem; padding: 1.5rem; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .chart-container { position: relative; width: 100%; }
        .raci-cell.raci-r { background-color: rgba(74, 222, 128, 0.1); }
        .raci-cell.raci-a { background-color: rgba(248, 113, 113, 0.1); }
        .raci-cell.raci-c { background-color: rgba(251, 191, 36, 0.1); }
        .raci-cell.raci-i { background-color: rgba(96, 165, 250, 0.1); }
        .risk-matrix { border-collapse: collapse; width: 100%; }
        .risk-matrix th, .risk-matrix td { border: 1px solid #e4e4e7; text-align: center; vertical-align: middle; }
        .risk-matrix th { padding: 0.5rem; background-color: #fafafa; }
        .risk-matrix td { height: 90px; width: 25%; padding: 0.5rem; }
        .risk-matrix .risk-tag { cursor: pointer; display: inline-block; margin: 2px; padding: 4px 8px; border-radius: 9999px; font-size: 0.8rem; font-weight: 600; transition: transform 0.2s; }
        .risk-matrix .risk-tag:hover { transform: scale(1.1); }
    </style>
</head>
<body class="bg-stone-100">

    <main id="main-content">
        <!-- Accueil Section -->
        <section id="accueil" class="section active min-h-screen flex flex-col items-center justify-center text-center bg-white">
            <div>
                <h1 class="text-4xl md:text-6xl font-bold text-stone-900">Projet Lancement</h1>
                <h2 class="text-5xl md:text-7xl font-extrabold text-orange-500 mt-2">Magasin autonome "PIVOTIS"</h2>
                <button id="enter-btn" class="mt-12 px-8 py-3 bg-orange-600 text-white font-semibold rounded-lg shadow-lg hover:bg-orange-700 transition-transform transform hover:scale-105">Découvrir le projet</button>
            </div>
        </section>

        <!-- Main Project Content -->
        <div id="project-content" class="hidden">
            <header class="bg-white shadow-md sticky top-0 z-20">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center py-4">
                        <h1 class="text-xl font-bold text-orange-500">Magasin autonome PIVOTIS</h1>
                        <nav class="hidden md:flex space-x-6">
                            <button data-target="dashboard" class="nav-button active py-2 text-sm font-medium">Tableaux de Bord</button>
                            <button data-target="projet" class="nav-button py-2 text-sm font-medium">Le Projet</button>
                            <button data-target="equipes" class="nav-button py-2 text-sm font-medium">Équipes</button>
                            <button data-target="risks" class="nav-button py-2 text-sm font-medium">Risques</button>
                            <button data-target="planning" class="nav-button py-2 text-sm font-medium">Planning</button>
                        </nav>
                    </div>
                </div>
            </header>

            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <section id="dashboard" class="section active">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="card text-center">
                            <h3 class="text-stone-500 text-sm font-medium uppercase mb-2">Délai Cible</h3>
                            <p class="text-3xl font-bold text-stone-900">1 Année</p>
                        </div>
                        <div class="card text-center">
                            <h3 class="text-stone-500 text-sm font-medium uppercase mb-2">Durée Planifiée</h3>
                            <p class="text-3xl font-bold text-stone-900">221 Jours</p>
                        </div>
                        <div class="card text-center">
                            <h3 class="text-stone-500 text-sm font-medium uppercase mb-2">Risques Critiques</h3>
                            <p class="text-3xl font-bold text-red-500">3</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                        <div class="lg:col-span-3 card">
                            <h3 class="text-xl font-semibold mb-4 text-orange-500">Feuille de Route Globale</h3>
                            <div class="chart-container h-72"><canvas id="mainGanttChart"></canvas></div>
                        </div>
                        <div class="lg:col-span-2 card">
                            <h3 class="text-xl font-semibold mb-4 text-orange-500">Délais Clés</h3>
                            <div class="space-y-4 pt-2">
                                <div class="flex items-center">
                                    <div class="w-24 text-sm font-bold text-orange-500">J+15</div>
                                    <div class="flex-1 pl-4 border-l-2 border-orange-500">
                                        <p class="font-semibold text-stone-800">Contrat d'Interface</p>
                                        <p class="text-xs text-stone-500">Fondations techniques validées</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-24 text-sm font-bold text-green-500">J+140</div>
                                    <div class="flex-1 pl-4 border-l-2 border-green-500">
                                        <p class="font-semibold text-stone-800">App Mobile (MVP)</p>
                                        <p class="text-xs text-stone-500">Première version livrée et testable</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-24 text-sm font-bold text-blue-500">J+195</div>
                                    <div class="flex-1 pl-4 border-l-2 border-blue-500">
                                        <p class="font-semibold text-stone-800">Socle Technique Prêt</p>
                                        <p class="text-xs text-stone-500">Lot 1 finalisé pour intégration</p>
                                    </div>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-24 text-sm font-bold text-red-500">J+221</div>
                                    <div class="flex-1 pl-4 border-l-2 border-red-500">
                                        <p class="font-semibold text-stone-800">MISE EN PRODUCTION</p>
                                        <p class="text-xs text-stone-500">Ouverture du magasin pilote</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="projet" class="section">
                    <h2 class="text-3xl font-bold mb-2 text-orange-500">Le Projet en Détail</h2>
                    <p class="text-stone-600 max-w-3xl mb-8">Au-delà d'un simple projet technique, nous construisons une nouvelle expérience d'achat. Voici comment.</p>
                    <div class="card mb-8">
                        <h3 class="text-xl font-semibold mb-2 text-orange-500">La Vision : Un Parcours Client Sans Friction</h3>
                        <p class="text-stone-600">L'objectif est de répondre à une attente forte des consommateurs : la rapidité et la simplicité. En supprimant l'étape de l'encaissement traditionnel, nous transformons le shopping en une expérience fluide et agréable. Le client entre, prend ses articles, et sort. La technologie s'occupe du reste, de manière invisible et sécurisée.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="card">
                            <h3 class="text-xl font-semibold mb-2 text-orange-500">Le Socle Magasin</h3>
                            <p class="text-stone-600 mb-4">C'est le cœur invisible du système, conçu pour une fiabilité maximale. Il gère :</p>
                            <ul class="list-disc list-inside text-stone-600 space-y-1">
                                <li>La détection des produits par technologie RFID.</li>
                                <li>Le calcul automatique et la facturation du panier.</li>
                                <li>L'interfaçage sécurisé avec les systèmes de paiement.</li>
                                <li>La synchronisation des stocks avec l'ERP SAP.</li>
                            </ul>
                        </div>
                        <div class="card">
                             <h3 class="text-xl font-semibold mb-2 text-orange-500">L'Application Mobile</h3>
                            <p class="text-stone-600 mb-4">C'est le compagnon d'achat du client, conçu pour être flexible et évolutif. Il permet de :</p>
                             <ul class="list-disc list-inside text-stone-600 space-y-1">
                                <li>S'identifier à l'entrée du magasin.</li>
                                <li>Recevoir des promotions personnalisées.</li>
                                <li>Consulter son historique d'achats et ses factures.</li>
                                <li>Accéder au support client.</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section id="equipes" class="section">
                    <h2 class="text-3xl font-bold mb-2 text-orange-500">Les Équipes du Projet</h2>
                    <p class="text-stone-600 max-w-3xl mb-8">La réussite du projet repose sur une collaboration claire et structurée. Voici qui fait quoi.</p>
                    <div class="card mb-8">
                        <h3 class="text-xl font-semibold mb-4 text-orange-500">Rôles Clés</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="roles-container"></div>
                    </div>
                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4 text-orange-500">Matrice des Responsabilités (RACI)</h3>
                        <div class="mb-6 space-y-4">
                            <p class="text-stone-600">Ce tableau clarifie pour chaque livrable majeur qui est impliqué et à quel niveau. Une bonne compréhension de cette matrice est un facteur clé de succès.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                                <div class="flex items-start"><span class="flex-shrink-0 w-5 h-5 text-center rounded-full bg-green-500 text-white font-bold mr-2">R</span><div><strong class="text-stone-800">Réalisateur :</strong> L'expert ou l'équipe qui exécute concrètement la tâche. Ce sont les "faiseurs".</div></div>
                                <div class="flex items-start"><span class="flex-shrink-0 w-5 h-5 text-center rounded-full bg-red-500 text-white font-bold mr-2">A</span><div><strong class="text-stone-800">Approbateur :</strong> Le décideur final. Il valide le travail et porte la responsabilité du résultat. Il n'y en a qu'un par tâche.</div></div>
                                <div class="flex items-start"><span class="flex-shrink-0 w-5 h-5 text-center rounded-full bg-yellow-500 text-black font-bold mr-2">C</span><div><strong class="text-stone-800">Consulté :</strong> L'expert dont l'avis est requis avant la décision. La communication est à double sens.</div></div>
                                <div class="flex items-start"><span class="flex-shrink-0 w-5 h-5 text-center rounded-full bg-blue-500 text-white font-bold mr-2">I</span><div><strong class="text-stone-800">Informé :</strong> La personne qui doit être tenue au courant du résultat, une fois la décision prise.</div></div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-sm">
                                <thead class="bg-stone-50">
                                    <tr>
                                        <th class="py-2 px-4 border-b border-stone-200 text-left font-semibold">Livrable Simplifié</th>
                                        <th class="py-2 px-4 border-b border-stone-200 text-center font-semibold">DP</th>
                                        <th class="py-2 px-4 border-b border-stone-200 text-center font-semibold">CP-V</th>
                                        <th class="py-2 px-4 border-b border-stone-200 text-center font-semibold">SM</th>
                                        <th class="py-2 px-4 border-b border-stone-200 text-center font-semibold">AS</th>
                                        <th class="py-2 px-4 border-b border-stone-200 text-center font-semibold">Client PO</th>
                                        <th class="py-2 px-4 border-b border-stone-200 text-center font-semibold">Client DSI</th>
                                    </tr>
                                </thead>
                                <tbody id="raci-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="risks" class="section">
                    <h2 class="text-3xl font-bold mb-2 text-orange-500">Maîtrise des Risques</h2>
                    <p class="text-stone-600 max-w-3xl mb-8">Nous avons identifié et évalué les menaces potentielles pour anticiper et mettre en place les plans d'action adéquats.</p>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 card">
                             <h3 class="text-xl font-semibold mb-4 text-orange-500">Matrice Probabilité / Impact</h3>
                             <p class="text-stone-600 mb-4">Cliquez sur un risque pour afficher son plan d'action.</p>
                             <div id="risk-matrix-container" class="overflow-x-auto"></div>
                        </div>
                        <div id="risk-details-panel" class="card">
                            <h3 class="text-xl font-semibold mb-4 text-orange-500">Détail du Risque</h3>
                            <div id="risk-details-content" class="text-stone-600">
                               <p>Sélectionnez un risque dans la matrice pour voir les détails ici.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="planning" class="section">
                    <h2 class="text-3xl font-bold mb-2 text-orange-500">Planning Opérationnel</h2>
                    <p class="text-stone-600 max-w-3xl mb-8">Notre feuille de route est structurée pour garantir une livraison dans les temps, en synchronisant nos deux équipes de développement.</p>
                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4 text-orange-500">Chronologie Détaillée du Projet</h3>
                        <div class="chart-container h-[700px]"><canvas id="detailedGanttChart"></canvas></div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script>
        const projectData = {
            risks: [
                { id: 'R01', category: 'Critique', description: "Le projet prend du retard et dépasse le délai d'un an.", probability: 3, gravity: 4, impact: "Non-respect du contrat, pénalités financières et perte de crédibilité.", actions: "Suivi hebdomadaire très strict du planning et des avancées." },
                { id: 'R02', category: 'Critique', description: "La mise à jour de SAP par le client rend notre système incompatible.", probability: 3, gravity: 4, impact: "Blocage total du magasin. Nécessité de redévelopper une partie de la solution.", actions: "Créer une passerelle technique ('adaptateur') pour nous protéger des changements SAP." },
                { id: 'R03', category: 'Critique', description: "L'expert SAP du client n'est pas disponible pour nous aider.", probability: 4, gravity: 3, impact: "Impossible de connecter notre système à SAP, le projet est bloqué.", actions: "Valider un planning de disponibilité avec l'expert et le faire confirmer par sa direction." },
                { id: 'R05', category: 'Élevé', description: "La technologie RFID ne scanne pas correctement tous les produits.", probability: 2, gravity: 4, impact: "Erreurs de caisse, clients facturés pour des produits non pris, mauvaise expérience.", actions: "Tester la technologie en conditions réelles en magasin avant de la déployer à grande échelle." },
                { id: 'R04', category: 'Élevé', description: "Désaccords internes chez le client sur les priorités du projet.", probability: 3, gravity: 3, impact: "Le projet est ralenti par des décisions lentes ou contradictoires.", actions: "La matrice RACI définit qui décide. En cas de blocage, le comité de pilotage tranchera." },
                { id: 'R06', category: 'Modéré', description: "Départ d'une personne-clé de l'équipe (Pivotis ou client).", probability: 2, gravity: 3, impact: "Perte de temps et de connaissance sur le projet.", actions: "Bien documenter le travail et encourager le travail en binôme sur les sujets complexes." },
                { id: 'R08', category: 'Modéré', description: "Piratage des puces RFID pour voler des produits.", probability: 2, gravity: 3, impact: "Perte financière (fraude) et atteinte à l'image de marque.", actions: "Utiliser des puces sécurisées (cryptées) et surveiller les transactions." },
                { id: 'R07', category: 'Faible', description: "Demandes de nouvelles fonctionnalités non prévues au départ.", probability: 3, gravity: 2, impact: "Retards et dépassement de budget si les ajouts ne sont pas maîtrisés.", actions: "Toute nouvelle demande doit être validée et priorisée par le Product Owner client." }
            ],
            planning: [
                { id: 1, task: 'Phase 0: Cadrage & Architecture', start: 1, end: 15, level: 0, duration: 15 },
                { id: 1.1, task: 'Ateliers Contrat Interface', start: 1, end: 10, level: 1, duration: 10 },
                { id: 1.2, task: 'Validation Contrat Interface', start: 11, end: 15, level: 1, duration: 5 },
                { id: 2, task: 'Phase 1: Lot 1 - Socle Technique (V-Model)', start: 16, end: 195, level: 0, duration: 180 },
                { id: 2.1, task: 'Conception Technique Détaillée', start: 16, end: 60, level: 1, duration: 45 },
                { id: 2.2, task: 'Développement & Tests Unitaires', start: 61, end: 160, level: 1, duration: 100 },
                { id: 2.3, task: 'Tests d\'Intégration du Socle', start: 161, end: 180, level: 1, duration: 20 },
                { id: 2.4, task: 'Documentation Technique', start: 181, end: 195, level: 1, duration: 15 },
                { id: 3, task: 'Phase 2: Lot 2 - App Mobile (Agile)', start: 16, end: 140, level: 0, duration: 125 },
                { id: 3.1, task: 'Sprint 0 (Setup & Outils)', start: 16, end: 20, level: 1, duration: 5 },
                { id: 3.2, task: 'Sprint 1 (Connexion & Panier)', start: 21, end: 35, level: 1, duration: 15 },
                { id: 3.3, task: 'Sprint 2 (Promotions & Fidélité)', start: 36, end: 50, level: 1, duration: 15 },
                { id: 3.4, task: 'Sprint 3 (Paiement & Facture)', start: 51, end: 65, level: 1, duration: 15 },
                { id: 3.5, task: 'Sprint 4 (Historique & Support)', start: 66, end: 80, level: 1, duration: 15 },
                { id: 3.6, task: 'Sprint 5 (Améliorations UX)', start: 81, end: 95, level: 1, duration: 15 },
                { id: 3.7, task: 'Sprint 6 (Optimisations & Tests)', start: 96, end: 110, level: 1, duration: 15 },
                { id: 3.8, task: 'Sprint 7 (Finalisation)', start: 111, end: 125, level: 1, duration: 15 },
                { id: 3.9, task: 'Recette finale App Mobile', start: 126, end: 135, level: 1, duration: 10 },
                { id: 4, task: 'Phase 3: Intégration & Recette Globale', start: 181, end: 220, level: 0, duration: 40 },
                { id: 4.1, task: 'Intégration des deux lots', start: 181, end: 190, level: 1, duration: 10 },
                { id: 4.2, task: 'Recette Utilisateur (UAT)', start: 191, end: 210, level: 1, duration: 20 },
                { id: 4.3, task: 'Tests de Performance & Sécurité', start: 211, end: 220, level: 1, duration: 10 },
                { id: 5, task: 'Phase 4: Déploiement & Go-Live', start: 211, end: 240, level: 0, duration: 30 },
                { id: 5.1, task: 'Préparation des serveurs', start: 211, end: 220, level: 1, duration: 10 },
                { id: 5.2, task: 'Formation des équipes magasin', start: 211, end: 230, level: 1, duration: 20 },
                { id: 5.3, task: 'MISE EN PRODUCTION', start: 221, end: 221, level: 1, duration: 1 },
                { id: 5.4, task: 'Support post-lancement', start: 222, end: 231, level: 1, duration: 10 },
            ],
            roles: [
                { name: 'Directeur de Projet (DP)', description: 'Chef d\'orchestre global, responsable des engagements.' },
                { name: 'Architecte de Solution (AS)', description: 'Garant de la cohérence technique globale.' },
                { name: 'Chef de Projet V-Model (CP-V)', description: 'Pilote du lot "Application Magasin".' },
                { name: 'Scrum Master (SM)', description: 'Facilitateur pour le lot "Application Mobile".' },
                { name: 'Équipes de Développement', description: 'Experts qui conçoivent et développent.' },
                { name: 'Client - Product Owner', description: 'Porte la vision du produit et priorise les fonctionnalités.' },
            ],
            raci: [
                { activity: "Définir l'architecture technique (Contrat d'Interface)", DP: 'A', 'CP-V': 'C', SM: 'C', AS: 'R', 'Client PO': 'C', 'Client DSI': 'A' },
                { activity: "Rédiger le cahier des charges du socle magasin (Lot 1)", DP: 'A', 'CP-V': 'R', SM: 'I', AS: 'C', 'Client PO': 'C', 'Client DSI': 'C' },
                { activity: "Prioriser les fonctionnalités de l'app mobile (Lot 2)", DP: 'C', 'CP-V': 'I', SM: 'C', AS: 'I', 'Client PO': 'A', 'Client DSI': 'I' },
                { activity: "Valider la recette finale par les utilisateurs", DP: 'A', 'CP-V': 'C', SM: 'C', AS: 'I', 'Client PO': 'A', 'Client DSI': 'R' },
            ],
        };

        // --- Chart Theming ---
        Chart.defaults.color = '#52525b';
        Chart.defaults.borderColor = '#e4e4e7';
        
        // --- Navigation ---
        document.getElementById('enter-btn').addEventListener('click', () => {
            document.getElementById('accueil').style.display = 'none';
            document.getElementById('project-content').style.display = 'block';
            document.getElementById('dashboard').classList.add('active');
            renderAllCharts();
        });

        const navButtons = document.querySelectorAll('.nav-button');
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.toggle('active', section.id === targetId);
                });
            });
        });

        // --- Data Population ---
        function populateContent() {
            const rolesContainer = document.getElementById('roles-container');
            rolesContainer.innerHTML = projectData.roles.map(role => `
                <div class="p-4 bg-stone-50 rounded-lg border border-stone-200">
                    <h4 class="font-semibold text-orange-500">${role.name}</h4>
                    <p class="text-sm text-stone-600">${role.description}</p>
                </div>
            `).join('');

            const raciTableBody = document.getElementById('raci-table-body');
            raciTableBody.innerHTML = projectData.raci.map(item => {
                let cells = `<td class="py-3 px-4 border-b border-stone-200 font-medium">${item.activity}</td>`;
                ['DP', 'CP-V', 'SM', 'AS', 'Client PO', 'Client DSI'].forEach(key => {
                    const role = item[key] || '';
                    const roleClass = role ? `raci-${role.toLowerCase()}` : '';
                    const colorClass = {'R': 'bg-green-500', 'A': 'bg-red-500', 'C': 'bg-yellow-500', 'I': 'bg-blue-500'}[role] || 'bg-transparent';
                    cells += `<td class="raci-cell ${roleClass} py-3 px-4 text-center border-b border-stone-200">
                               ${role ? `<span class="inline-block w-6 h-6 leading-6 rounded-full text-xs text-white font-bold ${colorClass}">${role}</span>` : ''}
                           </td>`;
                });
                return `<tr>${cells}</tr>`;
            }).join('');
        }

        // --- Risk Matrix ---
        function populateRiskMatrix() {
            const container = document.getElementById('risk-matrix-container');
            const matrix = Array.from({ length: 4 }, () => Array.from({ length: 4 }, () => []));
            projectData.risks.forEach(risk => {
                const rowIndex = 4 - risk.gravity;
                const colIndex = risk.probability - 1;
                if (rowIndex >= 0 && rowIndex < 4 && colIndex >= 0 && colIndex < 4) {
                    matrix[rowIndex][colIndex].push(risk);
                }
            });

            let html = '<table class="risk-matrix"><tbody>';
            const gravityLabels = ['Très Élevé', 'Élevé', 'Modéré', 'Faible'];
            const probabilityLabels = ['Rare', 'Peu Probable', 'Probable', 'Très Probable'];
            const colors = {
                'Faible': 'bg-green-500/10', 'Modéré': 'bg-yellow-500/10', 'Élevé': 'bg-orange-500/10', 'Critique': 'bg-red-500/10'
            };
            const tagColors = {
                'Faible': 'bg-green-500 text-white', 'Modéré': 'bg-yellow-500 text-black', 'Élevé': 'bg-orange-500 text-white', 'Critique': 'bg-red-500 text-white'
            };

            for (let i = 0; i < 4; i++) {
                html += `<tr><th class="h-16">${gravityLabels[i]}</th>`;
                for (let j = 0; j < 4; j++) {
                    const risksInCell = matrix[i][j];
                    const criticality = (4 - i) * (j + 1);
                    let level = 'Faible';
                    if (criticality >= 12) level = 'Critique';
                    else if (criticality >= 8) level = 'Élevé';
                    else if (criticality >= 4) level = 'Modéré';
                    
                    html += `<td class="${colors[level]}">`;
                    risksInCell.forEach(risk => {
                        html += `<span class="risk-tag ${tagColors[risk.category]}" data-risk-id="${risk.id}">${risk.id}</span>`;
                    });
                    html += '</td>';
                }
                html += '</tr>';
            }
            html += `<tr><th></th>${probabilityLabels.map(l => `<th>${l}</th>`).join('')}</tr>`;
            html += '</tbody></table>';
            container.innerHTML = html;

            container.querySelectorAll('.risk-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    const risk = projectData.risks.find(r => r.id === tag.dataset.riskId);
                    if (risk) updateRiskDetailsPanel(risk);
                });
            });
        }

        function updateRiskDetailsPanel(risk) {
            const panel = document.getElementById('risk-details-content');
            const colorClasses = {
                'Faible': 'text-green-500', 'Modéré': 'text-yellow-500', 'Élevé': 'text-orange-500', 'Critique': 'text-red-500'
            };
            panel.innerHTML = `
                <h4 class="font-bold text-lg mb-2 text-orange-500">${risk.id}: ${risk.description}</h4>
                <div class="mb-2"><span class="font-semibold text-stone-500">Niveau:</span> <span class="font-bold ${colorClasses[risk.category]}">${risk.category}</span></div>
                <div class="mt-4 pt-4 border-t border-stone-200">
                     <h5 class="font-semibold mb-1 text-stone-500">Impact si non maîtrisé</h5>
                     <p class="text-sm text-stone-600">${risk.impact}</p>
                </div>
                <div class="mt-4 pt-2 border-t border-stone-200">
                    <h5 class="font-semibold mb-1 text-stone-500">Plan d'Action</h5>
                    <p class="text-sm text-stone-600">${risk.actions}</p>
                </div>`;
        }
        
        // --- Chart Rendering ---
        function renderAllCharts() {
            populateContent();
            populateRiskMatrix();

            // Main Gantt
            new Chart(document.getElementById('mainGanttChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: projectData.planning.filter(p => p.level === 0).map(p => p.task),
                    datasets: [{
                        data: projectData.planning.filter(p => p.level === 0).map(p => [p.start, p.end]),
                        backgroundColor: 'rgba(249, 115, 22, 0.7)',
                        borderColor: 'rgba(249, 115, 22, 1)',
                        borderWidth: 1,
                        barPercentage: 0.6,
                    }]
                },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
            
            // Detailed Gantt
            new Chart(document.getElementById('detailedGanttChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: projectData.planning.map(p => p.level === 1 ? `  • ${p.task}` : p.task),
                    datasets: [{
                        data: projectData.planning.map(p => [p.start, p.end]),
                        backgroundColor: projectData.planning.map(p => p.level === 0 ? 'rgba(249, 115, 22, 0.8)' : 'rgba(120, 113, 108, 0.7)'),
                        borderColor: projectData.planning.map(p => p.level === 0 ? '#f97316' : '#a8a29e'),
                        borderWidth: 1, barPercentage: 0.8
                    }]
                },
                options: { 
                    indexAxis: 'y', 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { y: { ticks: { font: { size: 10 } } } }, 
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const task = projectData.planning[context.dataIndex];
                                    return `${task.task.replace('•','').trim()}: ${task.duration} jour(s) (J+${task.start} à J+${task.end})`;
                                }
                            }
                        }
                    } 
                }
            });
        }
    </script>
</body>
</html>
